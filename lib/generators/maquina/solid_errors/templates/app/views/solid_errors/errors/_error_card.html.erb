<%# locals: (error:) %>

<%= render "components/card", css_classes: "hover:shadow-md transition-shadow" do %>
  <div class="p-6">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <!-- Severity & Status -->
        <div class="flex items-center gap-2 mb-2">
          <%= render "components/severity_badge", severity: error.severity %>
          <%= render "components/error_status_badge", resolved: error.resolved? %>
        </div>

        <!-- Error Title -->
        <%= link_to solid_errors.error_path(error),
            class: "text-lg font-semibold text-foreground hover:text-primary transition-colors" do %>
          <code class="break-words"><%= error.exception_class %></code>
        <% end %>

        <div class="mt-1 text-sm text-muted-foreground">
          from <em><code><%= error.source %></code></em>
        </div>

        <!-- Message with overflow handling -->
        <pre
          class="
            mt-3 text-sm text-foreground whitespace-pre-wrap font-mono bg-muted/50 p-3
            rounded-md overflow-auto max-h-32 break-words
          "
        ><%= error.message %></pre>
      </div>

      <!-- Action Button -->
      <div class="flex-shrink-0">
        <% if error.resolved? %>
          <%= button_to solid_errors.error_path(error),
              method: :delete,
              form: { data: { turbo: false } },
              data: { turbo_confirm: "Are you sure you want to delete this error?" },
              class: "button button-danger inline-flex items-center gap-2 py-2 px-4 transition-all hover:scale-[1.02] active:scale-95" do %>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide"
            >
              <path d="M3 6h18" />
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
            </svg>

            <span>Delete</span>
          <% end %>
        <% else %>
          <%= button_to solid_errors.error_path(error),
              method: :patch,
              form: { data: { turbo: false } },
              params: { error: { resolved_at: Time.now } },
              class: "button button-primary inline-flex items-center gap-2 py-2 px-4 transition-all hover:scale-[1.02] active:scale-95" do %>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="m9 12 2 2 4-4" />
            </svg>

            <span>Resolve</span>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Footer Stats -->
    <div
      class="
        mt-4 flex items-center gap-6 text-sm text-muted-foreground border-t
        border-border pt-4
      "
    >
      <span>
        <strong class="text-foreground"><%= error.occurrences_count %></strong>
        occurrences
      </span>

      <span>
        Last seen
        <strong class="text-foreground"><%= time_ago_in_words(error.recent_occurrence) %></strong>
        ago
      </span>
    </div>
  </div>
<% end %>
